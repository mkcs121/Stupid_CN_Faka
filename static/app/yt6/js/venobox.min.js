/* 
 * VenoBox - jQuery Plugin
 * version: 1.2.2
 * @requires jQuery
 *
 * Examples at http://lab.veno.it/venobox/
 * License: Creative Commons Attribution 3.0 License
 * License URI: http://creativecommons.org/licenses/by/3.0/
 * Copyright 2013 Nicola Franchini - @nicolafranchini
 *
 */
(function(e){function _(){e.ajax({url:o,cache:false}).done(function(e){i.html('<div class="vbox-inline">'+e+"</div>");F()}).fail(function(){i.html('<div class="vbox-inline"><p>Error retrieving contents, please retry</div>');F()})}function D(){i.html('<iframe class="venoframe" src="'+o+'"></iframe>');F()}function P(){var e=o.split("/");var t=e[e.length-1];i.html('<iframe class="venoframe" src="http://player.vimeo.com/video/'+t+'"></iframe>');F()}function H(){var e=o.split("/");var t=e[e.length-1];i.html('<iframe class="venoframe" src="http://www.youtube.com/embed/'+t+'"></iframe>');F()}function B(){i.html('<div class="vbox-inline">'+e(o).html()+"</div>");F()}function j(){c=e(".vbox-content").find("img");c.one("load",function(){F()}).each(function(){if(this.complete)e(this).load()})}function F(){e(window).scrollTop(0);N.html(E);i.find(">:first-child").addClass("figlio");e(".figlio").css("width",h).css("height",p).css("padding",d).css("background",v);a=i.outerHeight();f=e(window).height();if(a+80<f){l=(f-a)/2;i.css("margin-top",l);i.css("margin-bottom",l)}else{i.css("margin-top","40px");i.css("margin-bottom","40px")}i.animate({opacity:"1"},"slow")}function I(){if(e(".vbox-content").length){a=i.height();f=e(window).height();if(a+80<f){l=(f-a)/2;i.css("margin-top",l);i.css("margin-bottom",l)}else{i.css("margin-top","40px");i.css("margin-bottom","40px")}}}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;e.fn.extend({venobox:function(a){var f={framewidth:"",frameheight:"",border:"0",bgcolor:"#fff",numeratio:false};var a=e.extend(f,a);return this.each(function(){var f=e(this);f.addClass("vbox-item");f.data("framewidth",a.framewidth);f.data("frameheight",a.frameheight);f.data("border",a.border);f.data("bgcolor",a.bgcolor);f.data("numeratio",a.numeratio);f.click(function(a){function l(){g=f.data("gall");k=f.data("numeratio");y=e('.vbox-item[data-gall="'+g+'"]');if(y.length>0&&k===true){C.html(y.index(f)+1+" / "+y.length);C.fadeIn()}else{C.fadeOut()}b=y.eq(y.index(f)+1);w=y.eq(y.index(f)-1);if(f.attr("title")){E=f.attr("title");N.fadeIn()}else{E="";N.fadeOut()}if(b.length>0){e(".vbox-next").css("display","block");S=true}else{e(".vbox-next").css("display","none");S=false}if(y.index(f)>0){e(".vbox-prev").css("display","block");x=true}else{e(".vbox-prev").css("display","none");x=false}}a.stopPropagation();a.preventDefault();f=e(this);h=f.data("framewidth");p=f.data("frameheight");d=f.data("border");v=f.data("bgcolor");S=false;x=false;T=false;o=f.attr("href");u=e(window).scrollTop();u=-u;e("body").wrapInner('<div class="vwrap"></div>');n=e(".vwrap");s='<div class="vbox-overlay"><div class="vbox-preloader">Loading...</div><div class="vbox-container"><div class="vbox-content"></div></div><div class="vbox-title"></div><div class="vbox-num">0/0</div><div class="vbox-close">X</div><div class="vbox-next">next</div><div class="vbox-prev">prev</div></div>';e("body").append(s);t=e(".vbox-overlay");r=e(".vbox-container");i=e(".vbox-content");C=e(".vbox-num");N=e(".vbox-title");i.html("");i.css("opacity","0");l();t.css({opacity:"1","min-height":e(window).outerHeight()+130});if(navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)){n.css({position:"fixed",top:u,opacity:"0"}).data("top",u)}else{n.css({position:"fixed",top:u}).data("top",u);e(window).scrollTop(0)}t.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){t.css({"min-height":e(window).outerHeight(),height:"auto"});if(f.data("type")=="iframe"){D()}else if(f.data("type")=="inline"){B()}else if(f.data("type")=="ajax"){_()}else if(f.data("type")=="vimeo"){P()}else if(f.data("type")=="youtube"){H()}else{i.html('<img src="'+o+'">');j()}});e("body").keydown(function(n){if(T)return;if(n.keyCode==37&&x==true){T=true;h=w.data("framewidth");p=w.data("frameheight");d=w.data("border");v=w.data("bgcolor");o=w.attr("href");if(w.attr("title")){E=w.attr("title")}else{E=""}t.css("min-height",e(window).outerHeight()+130);i.animate({opacity:0},500,function(){t.css("min-height",e(window).outerHeight());if(w.data("type")=="iframe"){D()}else if(w.data("type")=="inline"){B()}else if(w.data("type")=="ajax"){_()}else if(w.data("type")=="youtube"){H()}else if(w.data("type")=="vimeo"){P()}else{i.html('<img src="'+o+'">');j()}f=w;l();T=false})}if(n.keyCode==39&&S==true){T=true;h=b.data("framewidth");p=b.data("frameheight");d=b.data("border");v=b.data("bgcolor");o=b.attr("href");if(b.attr("title")){E=b.attr("title")}else{E=""}t.css("min-height",e(window).outerHeight()+130);i.animate({opacity:0},500,function(){t.css("min-height",e(window).outerHeight());if(b.data("type")=="iframe"){D()}else if(b.data("type")=="inline"){B()}else if(b.data("type")=="ajax"){_()}else if(b.data("type")=="youtube"){H()}else if(b.data("type")=="vimeo"){P()}else{i.html('<img src="'+o+'">');j()}f=b;l();T=false})}});e(".vbox-next").click(function(){h=b.data("framewidth");p=b.data("frameheight");d=b.data("border");v=b.data("bgcolor");o=b.attr("href");if(b.attr("title")){E=b.attr("title")}else{E=""}t.css("min-height",e(window).outerHeight()+130);i.animate({opacity:0},500,function(){t.css("min-height",e(window).outerHeight());if(b.data("type")=="iframe"){D()}else if(b.data("type")=="inline"){B()}else if(b.data("type")=="ajax"){_()}else if(b.data("type")=="youtube"){H()}else if(b.data("type")=="vimeo"){P()}else{i.html('<img src="'+o+'">');j()}f=b;l()})});e(".vbox-prev").click(function(){h=w.data("framewidth");p=w.data("frameheight");d=w.data("border");v=w.data("bgcolor");o=w.attr("href");if(w.attr("title")){E=w.attr("title")}else{E=""}t.css("min-height",e(window).outerHeight()+130);i.animate({opacity:0},500,function(){t.css("min-height",e(window).outerHeight());if(w.data("type")=="iframe"){D()}else if(w.data("type")=="inline"){B()}else if(w.data("type")=="ajax"){_()}else if(w.data("type")=="youtube"){H()}else if(w.data("type")=="vimeo"){P()}else{i.html('<img src="'+o+'">');j()}f=w;l()})});e(".vbox-close, .vbox-overlay").click(function(n){O=".figlio";A=".vbox-prev";L=".vbox-next";M=".figlio *";if(!e(n.target).is(O)&&!e(n.target).is(L)&&!e(n.target).is(A)&&!e(n.target).is(M)){t.css("opacity","0");t.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){t.remove();if(navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)){e(".vwrap").css("opacity","1");e(".vwrap").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){e(".vwrap").children().unwrap();e(window).scrollTop(-u)})}else{e(".vwrap").children().unwrap();e(window).scrollTop(-u)}T=false})}});return false})})}});e(window).resize(function(){I()})})(jQuery)