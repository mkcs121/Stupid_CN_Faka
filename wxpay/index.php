<?php
/* 解密版联系QQ：2337350403 - 官网：www.mfxw.cc */
 goto VQPry; VQPry: header("\103\x6f\x6e\164\x65\x6e\164\55\x74\171\x70\145\72\x74\x65\x78\164\x2f\x68\164\x6d\154\x3b\x20\x43\150\x61\162\163\x65\164\75\165\164\146\x2d\x38"); $mchid = "\61\64\x39\67\x31\67\x35\65\70"; $appid = "\x77\170\143\x62\x62\146\x62\x32\145\71\71\145\x62\141\141\60\x66"; $appKey = "\x32\145\63\66\60\x63\67\141\x62\61\x35\60\65\65\x39\66\x35\x65\60\146\x65\x34\x33\x36\142\65\67\145\144\x31\61"; $apiKey = "\x32\x65\x33\66\x30\143\x37\141\x62\x31\x35\60\x35\65\x39\66\65\145\60\x66\145\x34\x33\66\142\x35\x37\x65\x64\x31\61"; $wxPay = new WxpayService($mchid, $appid, $appKey, $apiKey); $openId = $wxPay->GetOpenid(); if ($openId) { goto hky6m; } exit("\xe8\x8e\xb7\xe5\217\226\157\160\145\x6e\x69\x64\xe5\244\xb1\350\264\245"); hky6m: goto AjdJD; NrI0a: echo "\x2c\15\xa\x20\40\40\x20\x20\x20\x20\40\40\x20\x20\x20\40\40\40\x20\x20\x20\40\x20\x66\165\156\x63\164\151\x6f\x6e\50\162\x65\163\51\x7b\xd\12\40\40\x20\40\40\x20\x20\x20\x20\40\x20\x20\x20\40\x20\x20\x20\40\x20\x20\x20\x20\x20\40\x57\x65\151\170\x69\x6e\112\123\x42\x72\x69\144\147\x65\56\x6c\x6f\x67\50\x72\145\163\x2e\145\x72\162\137\x6d\163\x67\51\73\xd\xa\11\x9\x9\x9\x9\11\x69\146\50\x72\x65\x73\56\145\162\162\137\155\x73\147\75\75\x27\147\x65\x74\x5f\142\162\141\156\144\137\x77\143\160\x61\171\x5f\162\x65\161\165\145\163\164\x3a\x6f\153\47\x29\x7b\xd\xa\11\x9\x9\x9\11\11\x9\x61\x6c\x65\x72\164\x28\47\346\224\xaf\xe4\xbb\230\346\210\220\345\x8a\237\357\xbc\201\x27\x29\x3b\xd\12\x9\x9\x9\11\x9\x9\11\x77\151\x6e\x64\157\x77\56\154\157\143\x61\164\x69\x6f\x6e\x2e\150\x72\145\146\75\x27"; echo $tjurl; echo "\47\x3b\xd\12\11\11\x9\11\11\11\x7d\145\x6c\163\x65\173\15\xa\x9\11\11\11\11\x9\11\141\x6c\145\x72\164\50\47\xe6\x94\257\xe4\xbb\x98\xe5\244\xb1\xe8\xb4\xa5\xef\274\x9a\47\53\x72\145\163\56\x65\x72\162\137\143\x6f\144\145\x2b\162\x65\x73\x2e\145\x72\162\x5f\x64\x65\x73\x63\53\162\145\163\56\x65\x72\x72\x5f\155\163\x67\51\x3b\15\xa\11\11\11\x9\11\x9\175\15\xa\x20\40\x20\x20\x20\40\40\x20\40\x20\40\40\x20\x20\x20\x20\40\40\x20\40\x7d\xd\xa\40\40\x20\x20\x20\x20\40\40\x20\40\x20\x20\x20\40\40\x20\51\73\xd\12\x20\x20\x20\x20\40\40\40\x20\x20\40\x20\40\175\15\xa\40\x20\40\40\x20\40\x20\x20\x20\40\40\40\x66\165\156\143\164\151\157\x6e\x20\143\x61\154\x6c\x70\141\171\50\x29\xd\12\40\40\x20\x20\x20\x20\40\40\x20\x20\x20\x20\173\xd\12\x20\x20\40\40\x20\40\x20\40\40\40\40\x20\40\40\x20\x20\x69\x66\40\50\x74\x79\x70\x65\x6f\146\40\x57\145\x69\170\151\x6e\112\123\102\x72\x69\144\147\145\40\75\x3d\x20\42\x75\156\144\x65\x66\151\156\145\144\42\51\173\15\12\x20\40\x20\40\40\x20\40\x20\x20\x20\40\40\x20\x20\40\x20\x20\x20\40\x20\x69\x66\50\x20\x64\x6f\143\165\x6d\145\x6e\164\x2e\x61\144\144\x45\x76\x65\156\x74\x4c\x69\x73\x74\145\x6e\x65\162\x20\x29\173\15\12\40\x20\40\40\x20\x20\x20\40\40\x20\x20\x20\x20\40\x20\40\40\40\x20\x20\40\40\x20\x20\x64\x6f\143\165\155\x65\x6e\x74\56\x61\x64\144\105\166\x65\x6e\164\x4c\151\x73\x74\145\156\145\162\50\x27\x57\145\x69\x78\151\156\112\x53\102\162\151\x64\147\x65\122\x65\141\x64\x79\x27\54\40\152\x73\101\x70\151\x43\x61\154\154\54\40\x66\x61\154\x73\145\51\73\xd\xa\x20\40\40\x20\x20\x20\x20\x20\40\x20\x20\40\40\x20\40\x20\x20\40\x20\x20\175\145\x6c\163\x65\x20\151\146\40\x28\x64\x6f\x63\x75\155\x65\x6e\x74\x2e\141\x74\164\x61\143\x68\105\166\x65\156\164\51\x7b\xd\12\x20\40\x20\40\40\x20\x20\x20\40\40\x20\40\x20\x20\40\40\x20\x20\40\40\x20\40\40\40\x64\x6f\x63\x75\x6d\145\x6e\x74\56\141\164\x74\x61\x63\150\105\x76\145\x6e\x74\50\47\127\x65\x69\x78\151\156\112\x53\x42\162\x69\x64\147\x65\x52\x65\x61\144\x79\47\54\40\x6a\163\x41\160\151\x43\x61\154\x6c\x29\73\15\12\40\40\x20\x20\x20\x20\x20\40\40\40\x20\x20\40\x20\40\40\x20\40\40\40\40\x20\x20\40\x64\x6f\x63\165\x6d\145\x6e\164\56\141\164\164\141\143\x68\x45\166\x65\156\164\x28\47\157\x6e\x57\145\151\170\151\x6e\x4a\123\102\162\x69\x64\x67\x65\122\x65\141\144\x79\x27\54\x20\x6a\163\101\160\x69\x43\141\154\x6c\51\73\xd\xa\40\x20\40\40\40\x20\x20\x20\40\40\40\x20\x20\40\40\40\x20\x20\x20\40\x7d\xd\12\x20\x20\40\x20\x20\x20\x20\x20\x20\40\x20\x20\x20\x20\x20\x20\175\x65\154\x73\145\173\xd\xa\40\40\40\x20\40\x20\x20\40\40\40\40\x20\40\x20\40\40\40\40\40\40\152\x73\x41\x70\x69\103\141\x6c\x6c\x28\51\73\15\xa\x20\40\x20\x20\40\40\40\40\40\40\40\40\40\x20\40\40\x7d\15\xa\x20\40\x20\x20\x20\40\x20\40\x20\40\x20\x20\x7d\15\xa\40\40\40\40\x20\40\x20\143\141\x6c\x6c\160\141\171\50\51\73\15\xa\x20\40\40\x20\x20\40\40\x20\x3c\x2f\163\143\162\151\x70\x74\76\15\xa\x20\x20\40\x20\74\57\150\145\x61\144\x3e\xd\12\x20\x20\x20\40\74\x62\157\144\171\x3e\xd\xa\40\x20\x20\40\xd\12\x20\40\40\40\x3c\x2f\142\157\x64\x79\76\xd\12\40\40\40\40\74\x2f\x68\x74\x6d\154\x3e\xd\xa"; goto sna0v; AjdJD: $outTradeNo = $_GET["\157\x72\x64\145\x72\x69\x64"]; $payAmount = $_GET["\x6d\x6f\x6e\x65\171"]; $orderName = $_GET["\163\165\142\152\145\x63\x74"]; $notifyUrl = "\150\164\164\160\x3a\x2f\x2f" . $_SERVER["\x48\x54\124\x50\137\x48\117\123\124"] . "\57\x70\141\x79\57\x6e\x6f\x74\x69\146\171\x2f\x57\170\160\x61\171\110\65"; $payTime = time(); $jsApiParameters = $wxPay->createJsBizPackage($openId, $payAmount, $outTradeNo, $orderName, $notifyUrl, $payTime); $jsApiParameters = json_encode($jsApiParameters); $tjurl = "\150\164\164\160\72\57\57" . $_SERVER["\x48\124\x54\x50\137\110\117\x53\x54"] . "\x2f\x6f\x72\144\145\x72\x71\x75\145\162\x79\77\x6f\162\144\145\x72\151\x64\75" . $outTradeNo; echo "\x20\x20\40\40\74\150\x74\155\x6c\x3e\xd\12\40\40\x20\40\x3c\150\x65\141\144\x3e\xd\xa\40\x20\x20\x20\x20\40\x20\40\74\155\x65\164\141\x20\143\150\141\x72\163\145\164\x3d\x22\x75\x74\146\55\x38\x22\40\x2f\x3e\xd\12\x20\x20\40\40\x20\x20\40\40\x3c\x6d\x65\164\141\x20\156\x61\155\145\x3d\42\166\x69\x65\167\x70\157\x72\x74\42\x20\143\157\x6e\x74\x65\x6e\164\75\42\167\x69\x64\164\150\75\144\145\166\x69\x63\145\55\167\151\x64\x74\x68\54\x20\x69\156\151\164\151\x61\x6c\55\163\143\141\x6c\145\x3d\61\x22\x2f\x3e\15\xa\40\40\40\x20\x20\40\x20\x20\x3c\164\151\164\x6c\x65\x3e\xe5\276\256\xe4\xbf\xa1\346\224\257\344\xbb\230\74\x2f\x74\x69\x74\154\145\76\xd\xa\x20\40\x20\x20\40\40\x20\x20\x3c\x73\143\x72\x69\x70\x74\x20\x74\171\160\145\75\x22\x74\145\x78\164\57\152\x61\x76\x61\163\143\x72\151\x70\x74\x22\x3e\xd\xa\x20\x20\x20\40\x20\x20\40\40\x20\x20\40\x20\57\x2f\350\xb0\x83\347\x94\xa8\xe5\xbe\256\xe4\277\241\x4a\x53\40\141\160\x69\x20\346\224\257\xe4\xbb\x98\15\xa\40\40\x20\40\x20\40\x20\x20\40\40\40\x20\x66\x75\x6e\x63\164\151\157\156\40\152\x73\101\160\151\x43\141\154\154\50\51\xd\xa\40\40\x20\x20\40\40\40\40\40\40\x20\40\173\xd\xa\x20\x20\x20\40\x20\40\x20\x20\x20\x20\40\x20\x20\40\x20\x20\127\145\151\x78\151\x6e\x4a\123\x42\x72\x69\144\147\145\56\151\x6e\166\x6f\153\145\50\15\xa\40\40\x20\x20\x20\40\40\x20\x20\40\x20\x20\x20\x20\x20\40\x20\40\x20\x20\x27\x67\145\164\102\162\x61\156\144\127\103\x50\141\x79\122\x65\x71\x75\x65\163\164\47\x2c\15\12\40\40\x20\40\x20\40\40\40\40\40\40\40\x20\x20\40\40\x20\x20\40\x20"; echo $jsApiParameters; goto NrI0a; sna0v: class WxpayService { protected $mchid; protected $appid; protected $appKey; protected $apiKey; public $data = null; public function __construct($mchid, $appid, $appKey, $key) { $this->mchid = $mchid; $this->appid = $appid; $this->appKey = $appKey; $this->apiKey = $key; } public function GetOpenid() { if (!isset($_GET["\x63\157\144\145"])) { goto dqc_S; } $code = $_GET["\143\x6f\x64\145"]; $openid = $this->getOpenidFromMp($code); return $openid; goto aKd48; dqc_S: $scheme = $_SERVER["\x48\124\x54\x50\x53"] == "\157\x6e" ? "\150\164\164\x70\163\x3a\57\57" : "\150\x74\164\x70\72\57\x2f"; $uri = $_SERVER["\x50\110\x50\137\123\x45\114\x46"] . $_SERVER["\121\125\x45\x52\x59\137\123\x54\122\111\x4e\107"]; if (!$_SERVER["\122\x45\121\x55\105\x53\x54\137\125\x52\x49"]) { goto nJspD; } $uri = $_SERVER["\122\105\121\125\105\123\124\137\125\x52\111"]; nJspD: $baseUrl = urlencode($scheme . $_SERVER["\x48\124\x54\120\x5f\x48\x4f\x53\x54"] . $uri); $url = $this->__CreateOauthUrlForCode($baseUrl); Header("\114\x6f\143\x61\x74\151\157\156\x3a\40{$url}"); exit; aKd48: } public function GetOpenidFromMp($code) { $url = $this->__CreateOauthUrlForOpenid($code); $res = self::curlGet($url); $data = json_decode($res, true); $this->data = $data; $openid = $data["\157\x70\x65\156\x69\x64"]; return $openid; } private function __CreateOauthUrlForOpenid($code) { $urlObj["\141\x70\x70\x69\x64"] = $this->appid; $urlObj["\163\x65\143\x72\145\164"] = $this->appKey; $urlObj["\143\157\x64\145"] = $code; $urlObj["\147\x72\x61\x6e\164\137\164\171\160\145"] = "\141\x75\164\150\157\x72\x69\172\141\x74\151\x6f\156\x5f\143\x6f\x64\145"; $bizString = $this->ToUrlParams($urlObj); return "\x68\x74\x74\x70\x73\x3a\57\x2f\x61\160\x69\56\167\x65\151\170\151\x6e\x2e\161\x71\x2e\143\157\155\57\163\156\x73\57\x6f\141\x75\x74\150\x32\x2f\x61\x63\143\x65\x73\x73\x5f\164\157\x6b\x65\x6e\77" . $bizString; } private function __CreateOauthUrlForCode($redirectUrl) { $urlObj["\x61\160\160\151\x64"] = $this->appid; $urlObj["\x72\x65\x64\x69\x72\x65\x63\164\x5f\165\162\x69"] = "{$redirectUrl}"; $urlObj["\x72\x65\163\x70\157\156\163\x65\137\164\171\160\145"] = "\143\157\x64\x65"; $urlObj["\x73\x63\157\160\x65"] = "\x73\156\163\x61\160\x69\x5f\142\141\x73\145"; $urlObj["\163\164\x61\x74\x65"] = "\123\x54\x41\124\x45" . "\x23\167\x65\x63\150\141\x74\137\x72\x65\x64\x69\x72\x65\143\164"; $bizString = $this->ToUrlParams($urlObj); return "\x68\x74\164\160\163\72\57\x2f\x6f\x70\145\x6e\x2e\167\x65\x69\x78\151\x6e\x2e\x71\x71\56\x63\157\x6d\57\143\157\x6e\156\x65\x63\164\57\x6f\x61\165\x74\x68\x32\57\141\x75\x74\x68\x6f\x72\151\172\x65\x3f" . $bizString; } private function ToUrlParams($urlObj) { $buff = ''; foreach ($urlObj as $k => $v) { if (!($k != "\x73\x69\147\x6e")) { goto a4Smm; } $buff .= $k . "\75" . $v . "\x26"; a4Smm: IWSjy: } kmrS2: $buff = trim($buff, "\x26"); return $buff; } public function createJsBizPackage($openid, $totalFee, $outTradeNo, $orderName, $notifyUrl, $timestamp) { $config = array("\155\x63\150\137\x69\144" => $this->mchid, "\141\160\160\x69\144" => $this->appid, "\153\x65\x79" => $this->apiKey); $unified = array("\141\160\160\x69\144" => $config["\x61\x70\x70\151\x64"], "\141\x74\x74\x61\143\150" => "\160\141\x79", "\142\157\144\x79" => $orderName, "\x6d\143\150\137\x69\x64" => $config["\155\x63\150\x5f\151\144"], "\x6e\x6f\x6e\143\x65\137\x73\x74\x72" => self::createNonceStr(), "\156\157\164\151\146\x79\137\165\162\x6c" => $notifyUrl, "\157\160\145\x6e\x69\144" => $openid, "\x6f\x75\x74\137\164\x72\x61\x64\145\x5f\156\157" => $outTradeNo, "\163\160\x62\151\x6c\x6c\137\x63\162\x65\x61\x74\x65\137\151\x70" => "\61\62\67\56\60\x2e\x30\x2e\61", "\x74\x6f\164\141\154\137\x66\145\145" => intval($totalFee * 100), "\x74\x72\x61\144\145\x5f\164\x79\160\x65" => "\112\123\x41\120\x49"); $unified["\163\151\x67\x6e"] = self::getSign($unified, $config["\x6b\x65\x79"]); $responseXml = self::curlPost("\150\164\x74\x70\x73\72\57\57\x61\160\x69\x2e\155\x63\150\x2e\167\x65\151\170\x69\x6e\56\x71\x71\x2e\143\x6f\x6d\x2f\x70\141\x79\x2f\165\x6e\x69\146\x69\145\144\157\162\x64\x65\162", self::arrayToXml($unified)); libxml_disable_entity_loader(true); $unifiedOrder = simplexml_load_string($responseXml, "\x53\x69\155\x70\154\x65\130\x4d\114\105\154\145\155\x65\x6e\164", LIBXML_NOCDATA); if (!($unifiedOrder === false)) { goto rtFY3; } die("\x70\x61\162\163\145\x20\170\x6d\x6c\x20\x65\x72\x72\x6f\162"); rtFY3: if (!($unifiedOrder->return_code != "\123\125\103\103\x45\123\123")) { goto Tel81; } die($unifiedOrder->return_msg); Tel81: if (!($unifiedOrder->result_code != "\123\125\103\103\105\123\x53")) { goto SknSl; } die($unifiedOrder->err_code); SknSl: $arr = array("\x61\x70\160\111\x64" => $config["\141\160\160\151\144"], "\164\x69\155\145\123\x74\141\x6d\160" => "{$timestamp}", "\x6e\x6f\156\143\x65\123\164\x72" => self::createNonceStr(), "\160\x61\143\x6b\141\x67\145" => "\160\162\145\160\x61\171\x5f\151\144\x3d" . $unifiedOrder->prepay_id, "\163\x69\x67\x6e\124\x79\160\x65" => "\115\x44\65"); $arr["\160\141\171\123\151\x67\156"] = self::getSign($arr, $config["\153\x65\171"]); return $arr; } public static function curlGet($url = '', $options = array()) { $ch = curl_init($url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_TIMEOUT, 30); if (empty($options)) { goto LzDQL; } curl_setopt_array($ch, $options); LzDQL: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); $data = curl_exec($ch); curl_close($ch); return $data; } public static function curlPost($url = '', $postData = '', $options = array()) { if (!is_array($postData)) { goto U0SC5; } $postData = http_build_query($postData); U0SC5: $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_POST, 1); curl_setopt($ch, CURLOPT_POSTFIELDS, $postData); curl_setopt($ch, CURLOPT_TIMEOUT, 30); if (empty($options)) { goto ajE65; } curl_setopt_array($ch, $options); ajE65: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); $data = curl_exec($ch); curl_close($ch); return $data; } public static function createNonceStr($length = 16) { $chars = "\x61\x62\143\x64\x65\146\147\150\151\152\x6b\154\x6d\x6e\x6f\x70\x71\x72\x73\164\x75\x76\167\x78\171\172\101\102\103\104\105\x46\x47\x48\x49\112\x4b\x4c\x4d\116\x4f\120\x51\x52\x53\x54\125\126\127\x58\131\x5a\60\x31\x32\x33\x34\x35\66\x37\70\71"; $str = ''; $i = 0; DSqfJ: if (!($i < $length)) { goto OgIW2; } $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); v25R3: $i++; goto DSqfJ; OgIW2: return $str; } public static function arrayToXml($arr) { $xml = "\74\170\155\x6c\76"; foreach ($arr as $key => $val) { if (is_numeric($val)) { goto liKHv; } $xml .= "\74" . $key . "\76\x3c\x21\133\x43\104\101\x54\101\133" . $val . "\135\135\76\x3c\x2f" . $key . "\x3e"; goto T52tZ; liKHv: $xml .= "\74" . $key . "\x3e" . $val . "\74\x2f" . $key . "\76"; T52tZ: oUCz4: } GvRQr: $xml .= "\74\57\x78\155\x6c\76"; return $xml; } public static function getSign($params, $key) { ksort($params, SORT_STRING); $unSignParaString = self::formatQueryParaMap($params, false); $signStr = strtoupper(md5($unSignParaString . "\x26\x6b\x65\x79\75" . $key)); return $signStr; } protected static function formatQueryParaMap($paraMap, $urlEncode = false) { $buff = ''; ksort($paraMap); foreach ($paraMap as $k => $v) { if (!(null != $v && "\156\x75\154\154" != $v)) { goto PnL9d; } if (!$urlEncode) { goto l9M3p; } $v = urlencode($v); l9M3p: $buff .= $k . "\75" . $v . "\x26"; PnL9d: xiXLS: } JlShQ: $reqPar = ''; if (!(strlen($buff) > 0)) { goto F7rmT; } $reqPar = substr($buff, 0, strlen($buff) - 1); F7rmT: return $reqPar; } }